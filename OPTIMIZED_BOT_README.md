# üöÄ BazaarGuru Optimized Bot

## –ú–∞—Å—à—Ç–∞–±–∏—Ä—É–µ–º–∞—è –≤–µ—Ä—Å–∏—è –¥–ª—è —Ç—ã—Å—è—á –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π

### ‚ö° –í–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏ –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏:

- ‚úÖ **Webhook –≤–º–µ—Å—Ç–æ Polling** - –¥–ª—è –≤—ã—Å–æ–∫–æ–π –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏
- ‚úÖ **Redis –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ** - —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–Ω–æ–µ —Ö—Ä–∞–Ω–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö
- ‚úÖ **Rate Limiting** - –∑–∞—â–∏—Ç–∞ –æ—Ç –ø–µ—Ä–µ–≥—Ä—É–∑–æ–∫
- ‚úÖ **Message Queue** - –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ —Å–æ–æ–±—â–µ–Ω–∏–π
- ‚úÖ **–ö–ª–∞—Å—Ç–µ—Ä–∏–∑–∞—Ü–∏—è** - –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –≤—Å–µ—Ö —è–¥–µ—Ä CPU
- ‚úÖ **–ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥** - –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏–µ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏
- ‚úÖ **Graceful Shutdown** - –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ–µ –∑–∞–≤–µ—Ä—à–µ–Ω–∏–µ —Ä–∞–±–æ—Ç—ã

---

## üì¶ –ë—ã—Å—Ç—Ä–∞—è —É—Å—Ç–∞–Ω–æ–≤–∫–∞

### 1. –ù–∞—Å—Ç—Ä–æ–π–∫–∞ production –æ–∫—Ä—É–∂–µ–Ω–∏—è
```bash
npm run setup:production
```

### 2. –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –æ–∫—Ä—É–∂–µ–Ω–∏—è
```bash
cp .env.production .env
# –û—Ç—Ä–µ–¥–∞–∫—Ç–∏—Ä—É–π—Ç–µ .env —Ñ–∞–π–ª —Å –≤–∞—à–∏–º–∏ API –∫–ª—é—á–∞–º–∏
```

### 3. –ó–∞–ø—É—Å–∫ –æ–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω–æ–≥–æ –±–æ—Ç–∞
```bash
npm run start:optimized
```

---

## üéØ –ö–æ–º–∞–Ω–¥—ã —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è

### –ó–∞–ø—É—Å–∫ –∏ –æ—Å—Ç–∞–Ω–æ–≤–∫–∞
```bash
# –ó–∞–ø—É—Å–∫ –≤ –∫–ª–∞—Å—Ç–µ—Ä–Ω–æ–º —Ä–µ–∂–∏–º–µ
npm run start:cluster

# –û—Å—Ç–∞–Ω–æ–≤–∫–∞
npm run stop:cluster

# –ü–µ—Ä–µ–∑–∞–ø—É—Å–∫
npm run restart:cluster
```

### –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥
```bash
# –í–µ–±-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å PM2
npm run monitor

# –ü—Ä–æ—Å–º–æ—Ç—Ä –ª–æ–≥–æ–≤
npm run logs

# –ú–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏–µ (–¥–æ–±–∞–≤–ª–µ–Ω–∏–µ/—É–¥–∞–ª–µ–Ω–∏–µ –∏–Ω—Å—Ç–∞–Ω—Å–æ–≤)
npm run scale +2  # –î–æ–±–∞–≤–∏—Ç—å 2 –∏–Ω—Å—Ç–∞–Ω—Å–∞
npm run scale -1  # –£–¥–∞–ª–∏—Ç—å 1 –∏–Ω—Å—Ç–∞–Ω—Å
```

### –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –±–æ—Ç–∞
```bash
# –ó–∞–ø—É—Å–∫ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏
node scripts/monitor-optimized-bot.js

# –û–¥–Ω–æ—Ä–∞–∑–æ–≤–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ –∑–¥–æ—Ä–æ–≤—å—è
node scripts/monitor-optimized-bot.js --once

# –≠–∫—Å–ø–æ—Ä—Ç –º–µ—Ç—Ä–∏–∫
node scripts/monitor-optimized-bot.js --export
```

---

## üìä –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –∏ –º–µ—Ç—Ä–∏–∫–∏

### Health Check endpoints:
```
http://localhost:3000/health  - –°—Ç–∞—Ç—É—Å –∑–¥–æ—Ä–æ–≤—å—è
http://localhost:3000/stats   - –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –±–æ—Ç–∞
```

### PM2 –∫–æ–º–∞–Ω–¥—ã:
```bash
pm2 list                    # –°–ø–∏—Å–æ–∫ –≤—Å–µ—Ö –ø—Ä–æ—Ü–µ—Å—Å–æ–≤
pm2 monit                   # –í–µ–±-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞
pm2 logs bazaarguru-optimized  # –ü—Ä–æ—Å–º–æ—Ç—Ä –ª–æ–≥–æ–≤
pm2 restart bazaarguru-optimized  # –ü–µ—Ä–µ–∑–∞–ø—É—Å–∫
pm2 stop bazaarguru-optimized     # –û—Å—Ç–∞–Ω–æ–≤–∫–∞
pm2 delete bazaarguru-optimized   # –£–¥–∞–ª–µ–Ω–∏–µ
```

---

## üèóÔ∏è –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê    ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ   NGINX Load    ‚îÇ‚îÄ‚îÄ‚îÄ‚îÄ‚îÇ   Node.js App   ‚îÇ
‚îÇ    Balancer     ‚îÇ    ‚îÇ   (Express)     ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò    ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                              ‚îÇ
                    ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
                    ‚îÇ         ‚îÇ         ‚îÇ
            ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
            ‚îÇ Redis Cache ‚îÇ ‚îÇ Message     ‚îÇ ‚îÇ PostgreSQL  ‚îÇ
            ‚îÇ             ‚îÇ ‚îÇ Queue (Bull)‚îÇ ‚îÇ Database    ‚îÇ
            ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

### –ö–æ–º–ø–æ–Ω–µ–Ω—Ç—ã:
- **Express Server** - Webhook –æ–±—Ä–∞–±–æ—Ç–∫–∞
- **Redis** - –ö—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ –∏ —Å–µ—Å—Å–∏–∏
- **Bull Queue** - –û—á–µ—Ä–µ–¥–∏ —Å–æ–æ–±—â–µ–Ω–∏–π
- **PM2** - –ü—Ä–æ—Ü–µ—Å—Å –º–µ–Ω–µ–¥–∂–µ—Ä
- **Nginx** - Load balancer

---

## ‚öôÔ∏è –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è

### –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è (.env):
```env
# –û—Å–Ω–æ–≤–Ω—ã–µ
TELEGRAM_BOT_TOKEN=your_token
PORT=3000
NODE_ENV=production

# Redis
REDIS_URL=redis://127.0.0.1:6379

# Webhook
WEBHOOK_URL=https://yourdomain.com/webhook

# API –∫–ª—é—á–∏ (–¥–æ–±–∞–≤—å—Ç–µ —Å–≤–æ–∏)
GOOGLE_MAPS_API_KEY=your_key
AMAZON_ACCESS_KEY=your_key
# ... –æ—Å—Ç–∞–ª—å–Ω—ã–µ –∫–ª—é—á–∏
```

### PM2 –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è (ecosystem.config.js):
```javascript
{
  name: 'bazaarguru-optimized',
  script: './scripts/bazaarguru-optimized-bot.js',
  instances: 'max',      // –í—Å–µ CPU —è–¥—Ä–∞
  exec_mode: 'cluster',  // –ö–ª–∞—Å—Ç–µ—Ä–Ω—ã–π —Ä–µ–∂–∏–º
  max_memory_restart: '500M', // –ü–µ—Ä–µ–∑–∞–ø—É—Å–∫ –ø—Ä–∏ 500MB
  restart_delay: 1000    // –ó–∞–¥–µ—Ä–∂–∫–∞ –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫–∞
}
```

---

## üö® –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –∞–ª–µ—Ä—Ç–æ–≤

### –£—Ä–æ–≤–Ω–∏ –∞–ª–µ—Ä—Ç–æ–≤:
- üî¥ **CRITICAL**: –¢—Ä–µ–±—É–µ—Ç –Ω–µ–º–µ–¥–ª–µ–Ω–Ω–æ–≥–æ –≤–Ω–∏–º–∞–Ω–∏—è
  - –ë–æ—Ç –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω
  - >85% –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –ø–∞–º—è—Ç–∏
  - >100 –æ—à–∏–±–æ–∫

- üü° **WARNING**: –¢—Ä–µ–±—É–µ—Ç –≤–Ω–∏–º–∞–Ω–∏—è
  - >70% –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –ø–∞–º—è—Ç–∏
  - >50 –æ—à–∏–±–æ–∫
  - –í—ã—Å–æ–∫–∞—è –Ω–∞–≥—Ä—É–∑–∫–∞ CPU

- ‚ÑπÔ∏è **INFO**: –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏–æ–Ω–Ω—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è
  - –ë–æ—Ç –∑–∞–ø—É—â–µ–Ω/–æ—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω
  - –ò–∑–º–µ–Ω–µ–Ω–∏—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏

---

## üìà –ú–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏–µ

### –ì–æ—Ä–∏–∑–æ–Ω—Ç–∞–ª—å–Ω–æ–µ –º–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏–µ:
```bash
# –î–æ–±–∞–≤–∏—Ç—å –∏–Ω—Å—Ç–∞–Ω—Å—ã
pm2 scale bazaarguru-optimized +2

# –£–¥–∞–ª–∏—Ç—å –∏–Ω—Å—Ç–∞–Ω—Å—ã
pm2 scale bazaarguru-optimized -1
```

### –í–µ—Ä—Ç–∏–∫–∞–ª—å–Ω–æ–µ –º–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏–µ:
```bash
# –£–≤–µ–ª–∏—á–∏—Ç—å –ª–∏–º–∏—Ç—ã
pm2 reload ecosystem.config.js --max-memory-restart 1G
```

---

## üîß –£—Å—Ç—Ä–∞–Ω–µ–Ω–∏–µ –Ω–µ–∏—Å–ø—Ä–∞–≤–Ω–æ—Å—Ç–µ–π

### –ü—Ä–æ–±–ª–µ–º–∞: –í—ã—Å–æ–∫–æ–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –ø–∞–º—è—Ç–∏
```bash
# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å
pm2 monit

# –†–µ—à–µ–Ω–∏–µ: —É–≤–µ–ª–∏—á–∏—Ç—å –ª–∏–º–∏—Ç –∏–ª–∏ –æ–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞—Ç—å –∫–æ–¥
pm2 reload ecosystem.config.js --max-memory-restart 1G
```

### –ü—Ä–æ–±–ª–µ–º–∞: –î–æ–ª–≥–æ–µ –≤—Ä–µ–º—è –æ—Ç–∫–ª–∏–∫–∞
```bash
# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ª–æ–≥–∏
npm run logs

# –†–µ—à–µ–Ω–∏–µ: –¥–æ–±–∞–≤–∏—Ç—å Redis –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ
# –∏–ª–∏ —É–≤–µ–ª–∏—á–∏—Ç—å –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –∏–Ω—Å—Ç–∞–Ω—Å–æ–≤
pm2 scale bazaarguru-optimized +1
```

### –ü—Ä–æ–±–ª–µ–º–∞: Rate limiting Telegram
```bash
# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É
curl http://localhost:3000/stats

# –†–µ—à–µ–Ω–∏–µ: –¥–æ–±–∞–≤–∏—Ç—å –∑–∞–¥–µ—Ä–∂–∫–∏ –º–µ–∂–¥—É –∑–∞–ø—Ä–æ—Å–∞–º–∏
# –∏–ª–∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å webhook –≤–º–µ—Å—Ç–æ polling
```

---

## üìã –ß–µ–∫-–ª–∏—Å—Ç –∑–∞–ø—É—Å–∫–∞

### –ü–µ—Ä–µ–¥ –∑–∞–ø—É—Å–∫–æ–º:
- [ ] –ù–∞—Å—Ç—Ä–æ–µ–Ω–æ production –æ–∫—Ä—É–∂–µ–Ω–∏–µ (`npm run setup:production`)
- [ ] –°–æ–∑–¥–∞–Ω—ã –≤—Å–µ –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã–µ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏ (logs, data, etc.)
- [ ] –ù–∞—Å—Ç—Ä–æ–µ–Ω—ã –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è (.env)
- [ ] –£—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω—ã –≤—Å–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏
- [ ] –ù–∞—Å—Ç—Ä–æ–µ–Ω Redis (–µ—Å–ª–∏ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è)
- [ ] –ù–∞—Å—Ç—Ä–æ–µ–Ω webhook URL

### –ü–æ—Å–ª–µ –∑–∞–ø—É—Å–∫–∞:
- [ ] –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –∑–¥–æ—Ä–æ–≤—å–µ: `http://localhost:3000/health`
- [ ] –ó–∞–ø—É—Å—Ç–∏—Ç—å –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥: `npm run monitor`
- [ ] –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ª–æ–≥–∏: `npm run logs`
- [ ] –ù–∞—Å—Ç—Ä–æ–∏—Ç—å –∞–ª–µ—Ä—Ç—ã –∏ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è

---

## üéâ –ì–æ—Ç–æ–≤ –∫ –∑–∞–ø—É—Å–∫—É!

### –ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç:
```bash
# 1. –ù–∞—Å—Ç—Ä–æ–π–∫–∞
npm run setup:production

# 2. –ó–∞–ø—É—Å–∫
npm run start:optimized

# 3. –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥
npm run monitor
```

### –ü—Ä–æ–¥–≤–∏–Ω—É—Ç—ã–π –∑–∞–ø—É—Å–∫:
```bash
# 1. –ù–∞—Å—Ç—Ä–æ–π–∫–∞
node scripts/setup-production.js

# 2. –ó–∞–ø—É—Å–∫ –∫–ª–∞—Å—Ç–µ—Ä–∞
npm run start:cluster

# 3. –ú–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏–µ
npm run scale +2

# 4. –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥
node scripts/monitor-optimized-bot.js
```

---

## üìû –ü–æ–¥–¥–µ—Ä–∂–∫–∞

### –†–µ—Å—É—Ä—Å—ã:
- üìñ –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è: `SCALING_GUIDE.md`
- üîß –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥: `scripts/monitor-optimized-bot.js`
- ‚öôÔ∏è –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è: `ecosystem.config.js`
- üìä –ú–µ—Ç—Ä–∏–∫–∏: `http://localhost:3000/health`

### –ü–æ–ª–µ–∑–Ω—ã–µ –∫–æ–º–∞–Ω–¥—ã:
```bash
# –ü—Ä–æ—Å–º–æ—Ç—Ä –≤—Å–µ—Ö –ø—Ä–æ—Ü–µ—Å—Å–æ–≤
pm2 list

# –î–µ—Ç–∞–ª—å–Ω—ã–π –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥
pm2 monit

# –ü—Ä–æ—Å–º–æ—Ç—Ä –ª–æ–≥–æ–≤ –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏
pm2 logs bazaarguru-optimized --lines 100

# –ü–µ—Ä–µ–∑–∞–ø—É—Å–∫ —Å –Ω–æ–≤–æ–π –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–µ–π
pm2 reload ecosystem.config.js
```

**üöÄ –í–∞—à –±–æ—Ç –≥–æ—Ç–æ–≤ –≤—ã–¥–µ—Ä–∂–∞—Ç—å —Ç—ã—Å—è—á–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π!**


