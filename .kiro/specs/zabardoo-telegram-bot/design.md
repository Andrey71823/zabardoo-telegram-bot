# –î–æ–∫—É–º–µ–Ω—Ç –î–∏–∑–∞–π–Ω–∞

## –û–±–∑–æ—Ä

Zabardoo Telegram Bot –ø—Ä–µ–¥—Å—Ç–∞–≤–ª—è–µ—Ç —Å–æ–±–æ–π –º–Ω–æ–≥–æ–∫–∞–Ω–∞–ª—å–Ω—É—é —ç–∫–æ—Å–∏—Å—Ç–µ–º—É, –ø–æ—Å—Ç—Ä–æ–µ–Ω–Ω—É—é –Ω–∞ –º–∏–∫—Ä–æ—Å–µ—Ä–≤–∏—Å–Ω–æ–π –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–µ –¥–ª—è –º–∞–∫—Å–∏–º–∏–∑–∞—Ü–∏–∏ —É–¥–µ—Ä–∂–∞–Ω–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –∏ –∫–æ–Ω–≤–µ—Ä—Å–∏–π –≤ –∫—É–ø–æ–Ω–Ω–æ–º –±–∏–∑–Ω–µ—Å–µ –≤ –ò–Ω–¥–∏–∏. –°–∏—Å—Ç–µ–º–∞ –≤–∫–ª—é—á–∞–µ—Ç —É–ø—Ä–∞–≤–ª—è–µ–º—É—é –±–æ—Ç–æ–º –≥—Ä—É–ø–ø—É –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è –∫—É–ø–æ–Ω–æ–≤, –ø–µ—Ä—Å–æ–Ω–∞–ª—å–Ω—ã–µ –∫–∞–Ω–∞–ª—ã-–∫–∞–±–∏–Ω–µ—Ç—ã –¥–ª—è –∫–∞–∂–¥–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è, –∏ –±–µ—Å—à–æ–≤–Ω—É—é –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—é —Å –æ—Å–Ω–æ–≤–Ω—ã–º –∫—É–ø–æ–Ω–Ω—ã–º —Å–∞–π—Ç–æ–º.

–ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ —Å–ø—Ä–æ–µ–∫—Ç–∏—Ä–æ–≤–∞–Ω–∞ –¥–ª—è –æ–±—Ä–∞–±–æ—Ç–∫–∏ –±–æ–ª—å—à–æ–≥–æ —Ç—Ä–∞—Ñ–∏–∫–∞ —Å —Ñ–æ–∫—É—Å–æ–º –Ω–∞ –º–Ω–æ–≥–æ–∫—Ä–∞—Ç–Ω–æ–µ –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏–µ —Å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º–∏, –ø–µ—Ä—Å–æ–Ω–∞–ª–∏–∑–∞—Ü–∏—é —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–π –∏ –º–∞–∫—Å–∏–º–∏–∑–∞—Ü–∏—é lifetime value –∫–∞–∂–¥–æ–≥–æ –∫–ª–∏–µ–Ω—Ç–∞.

## –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞

### –í—ã—Å–æ–∫–æ—É—Ä–æ–≤–Ω–µ–≤–∞—è –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞

```mermaid
graph TB
    subgraph "Telegram –≠–∫–æ—Å–∏—Å—Ç–µ–º–∞"
        GROUP[–£–ø—Ä–∞–≤–ª—è–µ–º–∞—è –ì—Ä—É–ø–ø–∞]
        PERSONAL[–ü–µ—Ä—Å–æ–Ω–∞–ª—å–Ω—ã–µ –ö–∞–Ω–∞–ª—ã]
        ADMIN[–ê–¥–º–∏–Ω –ò–Ω—Ç–µ—Ä—Ñ–µ–π—Å]
    end
    
    subgraph "API Gateway & Load Balancer"
        GW[API Gateway]
        LB[Load Balancer]
    end
    
    subgraph "–û—Å–Ω–æ–≤–Ω—ã–µ –°–µ—Ä–≤–∏—Å—ã"
        CHANNEL[Channel Manager]
        AI[AI –ü–µ—Ä—Å–æ–Ω–∞–ª—å–Ω—ã–π –ü–æ–º–æ—â–Ω–∏–∫]
        COUPON[Coupon Service]
        TRAFFIC[Traffic Manager]
        ANALYTICS[Analytics Service]
        RETENTION[Retention Engine]
    end
    
    subgraph "–ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏"
        SITE[–ö—É–ø–æ–Ω–Ω—ã–π –°–∞–π—Ç]
        TGAPI[Telegram Bot API]
        GPT[OpenAI GPT API]
        AFF[Affiliate Networks]
        PAY[Indian Payment Systems]
    end
    
    subgraph "–î–∞–Ω–Ω—ã–µ"
        REDIS[Redis Cache]
        DB[(PostgreSQL)]
        ANALYTICS_DB[(ClickHouse)]
        FILES[File Storage]
    end
    
    GROUP --> GW
    PERSONAL --> GW
    ADMIN --> GW
    
    GW --> LB
    LB --> CHANNEL
    LB --> AI
    LB --> COUPON
    LB --> TRAFFIC
    LB --> ANALYTICS
    LB --> RETENTION
    
    CHANNEL --> TGAPI
    AI --> GPT
    COUPON --> SITE
    COUPON --> AFF
    TRAFFIC --> SITE
    RETENTION --> PAY
    
    CHANNEL --> REDIS
    AI --> DB
    COUPON --> DB
    ANALYTICS --> ANALYTICS_DB
    TRAFFIC --> REDIS
```

### –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ –°–µ—Ä–≤–∏—Å–æ–≤

–°–∏—Å—Ç–µ–º–∞ –ø–æ—Å—Ç—Ä–æ–µ–Ω–∞ –Ω–∞ –º–∏–∫—Ä–æ—Å–µ—Ä–≤–∏—Å–Ω–æ–π –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–µ —Å–æ —Å–ª–µ–¥—É—é—â–∏–º–∏ –∫–ª—é—á–µ–≤—ã–º–∏ —Å–µ—Ä–≤–∏—Å–∞–º–∏:

1. **Channel Manager**: –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø–µ—Ä—Å–æ–Ω–∞–ª—å–Ω—ã–º–∏ –∫–∞–Ω–∞–ª–∞–º–∏ –∏ –≥—Ä—É–ø–ø–æ–π
2. **AI –ü–µ—Ä—Å–æ–Ω–∞–ª—å–Ω—ã–π –ü–æ–º–æ—â–Ω–∏–∫**: GPT-powered –∫–æ–Ω—Å—É–ª—å—Ç–∞–Ω—Ç –¥–ª—è –∫–∞–∂–¥–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
3. **Coupon Service**: –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∫—É–ø–æ–Ω–∞–º–∏ –∏ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å —Å–∞–π—Ç–æ–º
4. **Traffic Manager**: –û—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏–µ –ø–µ—Ä–µ—Ö–æ–¥–æ–≤ –∏ –∫–æ–Ω–≤–µ—Ä—Å–∏–π
5. **Analytics Service**: –ê–Ω–∞–ª–∏—Ç–∏–∫–∞ –ø–æ–≤–µ–¥–µ–Ω–∏—è –∏ —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏
6. **Retention Engine**: –°–∏—Å—Ç–µ–º–∞ —É–¥–µ—Ä–∂–∞–Ω–∏—è –∏ —Ä–µ–∞–∫—Ç–∏–≤–∞—Ü–∏–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
7. **Payment Integration**: –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å –∏–Ω–¥–∏–π—Å–∫–∏–º–∏ –ø–ª–∞—Ç–µ–∂–Ω—ã–º–∏ —Å–∏—Å—Ç–µ–º–∞–º–∏

## –ö–æ–º–ø–æ–Ω–µ–Ω—Ç—ã –∏ –ò–Ω—Ç–µ—Ä—Ñ–µ–π—Å—ã

### Channel Manager

**–û—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç–∏:**
- –°–æ–∑–¥–∞–Ω–∏–µ –∏ —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø–µ—Ä—Å–æ–Ω–∞–ª—å–Ω—ã–º–∏ –∫–∞–Ω–∞–ª–∞–º–∏ –¥–ª—è –∫–∞–∂–¥–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
- –ú–æ–¥–µ—Ä–∞—Ü–∏—è –∏ —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –æ—Å–Ω–æ–≤–Ω–æ–π –≥—Ä—É–ø–ø–æ–π
- –ú–∞—Ä—à—Ä—É—Ç–∏–∑–∞—Ü–∏—è —Å–æ–æ–±—â–µ–Ω–∏–π –º–µ–∂–¥—É –∫–∞–Ω–∞–ª–∞–º–∏
- –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è –∫–æ–Ω—Ç–µ–Ω—Ç–∞ –º–µ–∂–¥—É –≥—Ä—É–ø–ø–æ–π –∏ –ø–µ—Ä—Å–æ–Ω–∞–ª—å–Ω—ã–º–∏ –∫–∞–Ω–∞–ª–∞–º–∏

**–ö–ª—é—á–µ–≤—ã–µ –ò–Ω—Ç–µ—Ä—Ñ–µ–π—Å—ã:**
```typescript
interface ChannelManager {
  createPersonalChannel(userId: string): Promise<ChannelInfo>
  sendToPersonalChannel(userId: string, message: PersonalMessage): Promise<void>
  moderateGroupMessage(groupId: string, messageId: string): Promise<ModerationResult>
  syncCouponToPersonalChannels(coupon: Coupon, targetUsers: string[]): Promise<void>
}

interface PersonalMessage {
  text: string
  couponData?: CouponData
  redirectUrl?: string
  trackingParams: TrackingParams
}

interface ChannelInfo {
  channelId: string
  userId: string
  isActive: boolean
  createdAt: Date
  lastActivity: Date
}
```

### AI –ü–µ—Ä—Å–æ–Ω–∞–ª—å–Ω—ã–π –ü–æ–º–æ—â–Ω–∏–∫

**–û—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç–∏:**
- –ü–µ—Ä—Å–æ–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –∫–æ–Ω—Å—É–ª—å—Ç–∞—Ü–∏–∏ –ø–æ –∫—É–ø–æ–Ω–∞–º –≤ –ª–∏—á–Ω—ã—Ö –∫–∞–Ω–∞–ª–∞—Ö
- –ê–Ω–∞–ª–∏–∑ –∏—Å—Ç–æ—Ä–∏–∏ –ø–æ–∫—É–ø–æ–∫ –¥–ª—è —É–ª—É—á—à–µ–Ω–∏—è —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–π
- –ü—Ä–æ–∞–∫—Ç–∏–≤–Ω—ã–µ –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏—è –Ω–∞ –æ—Å–Ω–æ–≤–µ –ø–æ–≤–µ–¥–µ–Ω–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
- –ü–æ–º–æ—â—å –≤ —Å–æ–∑–¥–∞–Ω–∏–∏ –∫—É–ø–æ–Ω–æ–≤ –≤ –≥—Ä—É–ø–ø–µ

**–ö–ª—é—á–µ–≤—ã–µ –ò–Ω—Ç–µ—Ä—Ñ–µ–π—Å—ã:**
```typescript
interface AIPersonalAssistant {
  generatePersonalizedRecommendation(userId: string, context: UserPurchaseHistory): Promise<CouponRecommendation>
  processPersonalQuery(userId: string, query: string): Promise<PersonalizedResponse>
  analyzeUserBehavior(userId: string): Promise<BehaviorInsights>
  suggestCouponCreation(groupMessage: string): Promise<CouponSuggestion>
}

interface CouponRecommendation {
  coupon: Coupon
  personalizedMessage: string
  redirectUrl: string
  confidence: number
  reasoning: string
}

interface BehaviorInsights {
  preferredCategories: string[]
  shoppingPatterns: ShoppingPattern[]
  bestTimeToEngage: TimeWindow
  churnRisk: number
}
```

### Coupon Service

**–û—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç–∏:**
- –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è –∫—É–ø–æ–Ω–æ–≤ —Å –æ—Å–Ω–æ–≤–Ω—ã–º –∫—É–ø–æ–Ω–Ω—ã–º —Å–∞–π—Ç–æ–º
- –°–æ–∑–¥–∞–Ω–∏–µ –∞—Ñ—Ñ–∏–ª–µ–π—Ç—Å–∫–∏—Ö —Å—Å—ã–ª–æ–∫ —Å –ø—Ä–∞–≤–∏–ª—å–Ω–æ–π –∞—Ç—Ä–∏–±—É—Ü–∏–µ–π
- –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∂–∏–∑–Ω–µ–Ω–Ω—ã–º —Ü–∏–∫–ª–æ–º –∫—É–ø–æ–Ω–æ–≤
- –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å –∏–Ω–¥–∏–π—Å–∫–∏–º–∏ –º–∞–≥–∞–∑–∏–Ω–∞–º–∏ –∏ –ø–∞—Ä—Ç–Ω–µ—Ä–∞–º–∏

**–ö–ª—é—á–µ–≤—ã–µ –ò–Ω—Ç–µ—Ä—Ñ–µ–π—Å—ã:**
```typescript
interface CouponService {
  syncWithMainSite(): Promise<SyncResult>
  createAffiliateLink(couponId: string, userId: string, source: TrafficSource): Promise<string>
  getCouponsForUser(userId: string, preferences: UserPreferences): Promise<Coupon[]>
  trackCouponUsage(couponId: string, userId: string, action: CouponAction): Promise<void>
}

interface Coupon {
  id: string
  title: string
  description: string
  store: IndianStore
  category: string
  discountType: 'percentage' | 'fixed' | 'offer'
  discountValue?: number
  couponCode?: string
  directLink?: string
  sitePageUrl: string
  expiryDate?: Date
  isPopularInIndia: boolean
  supportedPayments: IndianPaymentMethod[]
}

interface IndianStore {
  name: string
  domain: string
  isPopular: boolean
  supportedRegions: string[]
  paymentMethods: IndianPaymentMethod[]
}
```

### Traffic Manager

**–û—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç–∏:**
- –û—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏–µ –≤—Å–µ—Ö –ø–µ—Ä–µ—Ö–æ–¥–æ–≤ —Å Telegram –Ω–∞ –∫—É–ø–æ–Ω–Ω—ã–π —Å–∞–π—Ç
- –ê—Ç—Ä–∏–±—É—Ü–∏—è –∫–æ–Ω–≤–µ—Ä—Å–∏–π –∫ –ø—Ä–∞–≤–∏–ª—å–Ω—ã–º –∏—Å—Ç–æ—á–Ω–∏–∫–∞–º —Ç—Ä–∞—Ñ–∏–∫–∞
- –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –º–∞—Ä—à—Ä—É—Ç–æ–≤ –¥–ª—è –º–∞–∫—Å–∏–º–∏–∑–∞—Ü–∏–∏ –∫–æ–Ω–≤–µ—Ä—Å–∏–π
- –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å –∞–Ω–∞–ª–∏—Ç–∏–∫–æ–π —Å–∞–π—Ç–∞

**–ö–ª—é—á–µ–≤—ã–µ –ò–Ω—Ç–µ—Ä—Ñ–µ–π—Å—ã:**
```typescript
interface TrafficManager {
  trackClick(userId: string, couponId: string, source: TrafficSource): Promise<ClickEvent>
  trackConversion(clickId: string, conversionData: ConversionData): Promise<void>
  generateTrackingUrl(couponId: string, userId: string, source: TrafficSource): Promise<string>
  getTrafficAnalytics(timeRange: TimeRange): Promise<TrafficAnalytics>
}

interface ClickEvent {
  clickId: string
  userId: string
  couponId: string
  source: TrafficSource
  timestamp: Date
  userAgent: string
  redirectUrl: string
}

interface TrafficSource {
  type: 'personal_channel' | 'group' | 'ai_recommendation'
  channelId?: string
  messageId?: string
  campaignId?: string
}

interface ConversionData {
  orderId: string
  orderValue: number
  currency: 'INR'
  commission: number
  conversionTime: Date
}
```

### Retention Engine

**–û—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç–∏:**
- –ê–Ω–∞–ª–∏–∑ –ø–æ–≤–µ–¥–µ–Ω–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –¥–ª—è –ø—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–µ–Ω–∏—è –æ—Ç—Ç–æ–∫–∞
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–µ –∫–∞–º–ø–∞–Ω–∏–∏ —Ä–µ–∞–∫—Ç–∏–≤–∞—Ü–∏–∏
- –ü–µ—Ä—Å–æ–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ —Å—Ç—Ä–∞—Ç–µ–≥–∏–∏ —É–¥–µ—Ä–∂–∞–Ω–∏—è
- A/B —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ retention —Å—Ç—Ä–∞—Ç–µ–≥–∏–π

**–ö–ª—é—á–µ–≤—ã–µ –ò–Ω—Ç–µ—Ä—Ñ–µ–π—Å—ã:**
```typescript
interface RetentionEngine {
  analyzeChurnRisk(userId: string): Promise<ChurnAnalysis>
  triggerReactivationCampaign(userId: string, strategy: RetentionStrategy): Promise<void>
  scheduleFollowUpMessages(userId: string, purchaseData: PurchaseData): Promise<void>
  optimizeEngagementTiming(userId: string): Promise<OptimalTiming>
}

interface ChurnAnalysis {
  riskScore: number
  lastActivity: Date
  engagementTrend: 'increasing' | 'stable' | 'declining'
  recommendedActions: RetentionAction[]
}

interface RetentionStrategy {
  type: 'exclusive_offer' | 'personalized_discount' | 'category_reminder' | 'social_proof'
  message: string
  incentive?: Incentive
  timing: Date
}

interface OptimalTiming {
  bestHours: number[]
  bestDaysOfWeek: number[]
  timezone: string
  confidence: number
}
```

### Analytics Service

**–û—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç–∏:**
- –°–±–æ—Ä –∏ –∞–Ω–∞–ª–∏–∑ –≤—Å–µ—Ö –º–µ—Ç—Ä–∏–∫ –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
- –ü–æ—Å—Ç—Ä–æ–µ–Ω–∏–µ –≤–æ—Ä–æ–Ω–æ–∫ –∫–æ–Ω–≤–µ—Ä—Å–∏–π
- –ü—Ä–æ–≥–Ω–æ–∑–∏—Ä–æ–≤–∞–Ω–∏–µ –ø–æ–≤–µ–¥–µ–Ω–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
- –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –æ—Ç—á–µ—Ç–æ–≤ –¥–ª—è –±–∏–∑–Ω–µ—Å-–∞–Ω–∞–ª–∏—Ç–∏–∫–∏

**–ö–ª—é—á–µ–≤—ã–µ –ò–Ω—Ç–µ—Ä—Ñ–µ–π—Å—ã:**
```typescript
interface AnalyticsService {
  trackUserEvent(userId: string, event: UserEvent): Promise<void>
  generateConversionFunnel(timeRange: TimeRange): Promise<ConversionFunnel>
  predictUserBehavior(userId: string): Promise<BehaviorPrediction>
  getBusinessMetrics(period: AnalyticsPeriod): Promise<BusinessMetrics>
}

interface UserEvent {
  type: 'channel_visit' | 'coupon_view' | 'click_through' | 'purchase' | 'group_interaction'
  userId: string
  timestamp: Date
  metadata: Record<string, any>
  source: TrafficSource
}

interface BusinessMetrics {
  totalUsers: number
  activeUsers: number
  conversionRate: number
  averageOrderValue: number
  lifetimeValue: number
  churnRate: number
  revenueByChannel: ChannelRevenue[]
}

interface ChannelRevenue {
  channelType: 'personal' | 'group'
  revenue: number
  conversions: number
  users: number
}
```

## –ú–æ–¥–µ–ª–∏ –î–∞–Ω–Ω—ã—Ö

### –û—Å–Ω–æ–≤–Ω—ã–µ –ú–æ–¥–µ–ª–∏ –î–∞–Ω–Ω—ã—Ö

```typescript
// –ú–æ–¥–µ–ª—å –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è —Å –ü–µ—Ä—Å–æ–Ω–∞–ª—å–Ω—ã–º –ö–∞–Ω–∞–ª–æ–º
interface User {
  id: string
  telegramId: string
  username?: string
  firstName: string
  lastName?: string
  languageCode: 'en' | 'hi'
  personalChannelId: string
  createdAt: Date
  lastActiveAt: Date
  preferences: IndianUserPreferences
  purchaseHistory: PurchaseHistory[]
  churnRisk: number
  lifetimeValue: number
}

interface IndianUserPreferences {
  categories: string[]
  preferredStores: IndianStore[]
  paymentMethods: IndianPaymentMethod[]
  priceRange: PriceRange
  notificationTiming: NotificationTiming
  currency: 'INR'
  region: IndianRegion
}

// –ú–æ–¥–µ–ª—å –ö—É–ø–æ–Ω–∞ –¥–ª—è –ò–Ω–¥–∏–π—Å–∫–æ–≥–æ –†—ã–Ω–∫–∞
interface Coupon {
  id: string
  title: string
  description: string
  store: IndianStore
  category: string
  discountType: 'percentage' | 'fixed' | 'offer' | 'cashback'
  discountValue?: number
  couponCode?: string
  sitePageUrl: string
  directStoreUrl?: string
  isTextCoupon: boolean
  expiryDate?: Date
  isPopularInIndia: boolean
  supportedRegions: IndianRegion[]
  createdInGroup?: boolean
  creatorUserId?: string
}

// –ú–æ–¥–µ–ª—å –ü–µ—Ä—Å–æ–Ω–∞–ª—å–Ω–æ–≥–æ –ö–∞–Ω–∞–ª–∞
interface PersonalChannel {
  id: string
  userId: string
  channelId: string
  isActive: boolean
  lastMessageAt: Date
  engagementScore: number
  preferredMessageTypes: MessageType[]
  optimalSendTimes: TimeWindow[]
}

// –ú–æ–¥–µ–ª—å –û—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏—è –¢—Ä–∞—Ñ–∏–∫–∞
interface TrafficEvent {
  id: string
  userId: string
  couponId: string
  source: TrafficSource
  clickTimestamp: Date
  conversionTimestamp?: Date
  orderValue?: number
  commission?: number
  status: 'clicked' | 'converted' | 'abandoned'
}

// –ú–æ–¥–µ–ª—å –ê–Ω–∞–ª–∏—Ç–∏–∫–∏ –£–¥–µ—Ä–∂–∞–Ω–∏—è
interface RetentionMetrics {
  userId: string
  daysSinceLastPurchase: number
  totalPurchases: number
  averageOrderValue: number
  preferredCategories: string[]
  engagementTrend: 'up' | 'stable' | 'down'
  nextBestAction: RetentionAction
}

// –ò–Ω–¥–∏–π—Å–∫–∏–µ –°–ø–µ—Ü–∏—Ñ–∏—á–Ω—ã–µ –ú–æ–¥–µ–ª–∏
interface IndianStore {
  id: string
  name: string
  domain: string
  isPopular: boolean
  supportedRegions: IndianRegion[]
  paymentMethods: IndianPaymentMethod[]
  averageCommission: number
  conversionRate: number
}

interface IndianPaymentMethod {
  type: 'UPI' | 'PayTM' | 'PhonePe' | 'GooglePay' | 'NetBanking' | 'COD'
  isPreferred: boolean
}

type IndianRegion = 'North' | 'South' | 'East' | 'West' | 'Central' | 'Northeast'
```

### –°—Ö–µ–º–∞ –ë–∞–∑—ã –î–∞–Ω–Ω—ã—Ö

**PostgreSQL –¢–∞–±–ª–∏—Ü—ã:**
- `users` - –ü—Ä–æ—Ñ–∏–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π —Å –ø–µ—Ä—Å–æ–Ω–∞–ª—å–Ω—ã–º–∏ –∫–∞–Ω–∞–ª–∞–º–∏
- `personal_channels` - –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –ø–µ—Ä—Å–æ–Ω–∞–ª—å–Ω—ã—Ö –∫–∞–Ω–∞–ª–∞—Ö
- `coupons` - –ö–∞—Ç–∞–ª–æ–≥ –∫—É–ø–æ–Ω–æ–≤ —Å –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–µ–π —Å–∞–π—Ç–∞
- `indian_stores` - –ü–æ–ø—É–ª—è—Ä–Ω—ã–µ –∏–Ω–¥–∏–π—Å–∫–∏–µ –º–∞–≥–∞–∑–∏–Ω—ã
- `traffic_events` - –û—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏–µ –∫–ª–∏–∫–æ–≤ –∏ –∫–æ–Ω–≤–µ—Ä—Å–∏–π
- `purchase_history` - –ò—Å—Ç–æ—Ä–∏—è –ø–æ–∫—É–ø–æ–∫ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
- `retention_metrics` - –ú–µ—Ç—Ä–∏–∫–∏ —É–¥–µ—Ä–∂–∞–Ω–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
- `group_interactions` - –í–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏—è –≤ —É–ø—Ä–∞–≤–ª—è–µ–º–æ–π –≥—Ä—É–ø–ø–µ
- `cashback_transactions` - –¢—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏ –∫—ç—à–±–µ–∫–∞
- `withdrawal_requests` - –ó–∞–ø—Ä–æ—Å—ã –Ω–∞ –≤—ã–≤–æ–¥ —Å—Ä–µ–¥—Å—Ç–≤ (UPI/PayTM)

**ClickHouse –¢–∞–±–ª–∏—Ü—ã (–ê–Ω–∞–ª–∏—Ç–∏–∫–∞):**
- `user_events` - –í—Å–µ —Å–æ–±—ã—Ç–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
- `conversion_funnel` - –î–∞–Ω–Ω—ã–µ –≤–æ—Ä–æ–Ω–∫–∏ –∫–æ–Ω–≤–µ—Ä—Å–∏–π
- `channel_performance` - –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å –∫–∞–Ω–∞–ª–æ–≤
- `retention_cohorts` - –ö–æ–≥–æ—Ä—Ç–Ω—ã–π –∞–Ω–∞–ª–∏–∑ —É–¥–µ—Ä–∂–∞–Ω–∏—è

**Redis Cache –°—Ç—Ä—É–∫—Ç—É—Ä–∞:**
- `user_session:{userId}` - –ê–∫—Ç–∏–≤–Ω—ã–µ —Å–µ—Å—Å–∏–∏ –∏ –∫–æ–Ω—Ç–µ–∫—Å—Ç
- `coupon_cache:{category}:{region}` - –ö—ç—à –∫—É–ø–æ–Ω–æ–≤ –ø–æ —Ä–µ–≥–∏–æ–Ω–∞–º
- `personal_recommendations:{userId}` - –ü–µ—Ä—Å–æ–Ω–∞–ª—å–Ω—ã–µ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏
- `traffic_attribution:{clickId}` - –ê—Ç—Ä–∏–±—É—Ü–∏—è —Ç—Ä–∞—Ñ–∏–∫–∞
- `retention_queue:{userId}` - –û—á–µ—Ä–µ–¥—å retention —Å–æ–æ–±—â–µ–Ω–∏–π
- `rate_limit:{userId}:{action}` - Rate limiting –ø–æ –¥–µ–π—Å—Ç–≤–∏—è–º

## Error Handling

### Error Categories and Responses

1. **User Input Errors**
   - Invalid commands or parameters
   - Graceful fallback with helpful suggestions
   - Maintain conversation flow

2. **External API Failures**
   - Affiliate API timeouts or errors
   - GPT API rate limits or failures
   - Payment gateway issues
   - Implement circuit breakers and fallbacks

3. **System Errors**
   - Database connection issues
   - Service unavailability
   - Memory or performance issues
   - Comprehensive logging and alerting

### Error Response Strategy

```typescript
interface ErrorResponse {
  userMessage: string  // Friendly message for user
  logMessage: string   // Technical details for logging
  errorCode: string    // Categorized error code
  retryable: boolean   // Whether user can retry
  fallbackAction?: string  // Alternative action suggestion
}

// Example error handling
const handleDealSearchError = (error: Error): ErrorResponse => {
  if (error instanceof APITimeoutError) {
    return {
      userMessage: "Sorry, deal search is taking longer than usual. Try again in a moment! üîÑ",
      logMessage: `Deal API timeout: ${error.message}`,
      errorCode: "DEAL_API_TIMEOUT",
      retryable: true,
      fallbackAction: "show_cached_deals"
    }
  }
  // ... other error types
}
```

## Testing Strategy

### Testing Pyramid

1. **Unit Tests (70%)**
   - Individual service methods
   - Data model validation
   - Business logic functions
   - Mock external dependencies

2. **Integration Tests (20%)**
   - Service-to-service communication
   - Database operations
   - External API integrations
   - End-to-end user flows

3. **End-to-End Tests (10%)**
   - Complete user journeys
   - Telegram bot interactions
   - WebApp functionality
   - Performance testing

### Test Implementation

```typescript
// Example unit test structure
describe('DealService', () => {
  describe('searchDeals', () => {
    it('should return filtered deals based on query', async () => {
      // Test implementation
    })
    
    it('should handle empty search results gracefully', async () => {
      // Test implementation
    })
    
    it('should apply category filters correctly', async () => {
      // Test implementation
    })
  })
})

// Integration test example
describe('Bot Integration', () => {
  it('should handle /start command and create new user', async () => {
    // Test bot command handling
  })
  
  it('should process deal search and return results', async () => {
    // Test complete deal search flow
  })
})
```

### Performance Testing

- Load testing for concurrent users (target: 10,000+ concurrent)
- API response time benchmarks (target: <500ms for deal searches)
- Database query optimization
- Cache hit rate monitoring
- Memory usage profiling

### Security Testing

- Input validation and sanitization
- SQL injection prevention
- Rate limiting effectiveness
- Authentication and authorization
- Data encryption verification
- Bot token security

## Deployment and Scalability

### Container Architecture

```dockerfile
# Example service container
FROM node:18-alpine
WORKDIR /app
COPY package*.json ./
RUN npm ci --only=production
COPY . .
EXPOSE 3000
CMD ["npm", "start"]
```

### Kubernetes Deployment

- Separate deployments for each microservice
- Horizontal Pod Autoscaling based on CPU/memory
- Service mesh for inter-service communication
- ConfigMaps for environment-specific settings
- Secrets management for API keys and tokens

### Monitoring and Observability

- Application metrics (response times, error rates)
- Business metrics (user engagement, conversion rates)
- Infrastructure monitoring (CPU, memory, disk)
- Distributed tracing for request flows
- Centralized logging with structured logs
- Alerting for critical issues

This design provides a robust, scalable foundation for the Zabardoo Telegram Bot that can handle the complex requirements while maintaining performance and reliability.